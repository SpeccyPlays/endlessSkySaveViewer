<!DOCTYPE html>
<html>
<head>
    <title>SpeccyPlays Endless Sky save file viewer</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.png" />
    <link rel="stylesheet" type="text/css" href="/CSS/styles.css" />
</head>
<body>
    <button onclick="openFile()">Open a file</button>
    <input id="inp" type='file' style="visibility:hidden;" onchange="readFile(event)" />
    <div id="contents">
    <ul id="result"></ul>
    </div>
    <script>
        class Node {
            constructor(value, tabCount){
                this.value = value;
                this.parent = null;
                this.indentLevel = tabCount;
                this.children = [];
            }
        }
        function openFile() {
            document.getElementById('inp').click();
        }
        function readFile(e) {
            var file = e.target.files[0];
            if (!file) return;
            var reader = new FileReader();

            let output = {
                pilot : "",
                missions : [],
                conditions : [],
                visited : [],
                ships : []
            }
            reader.onload = function(e) {
                let target = document.getElementById('result');
                const data = e.target.result.split('\n');
                //used to help with nesting
                let topLevelLine = "";
                for (line in data){

                    const text = data[line];
                    const numOfTabs = numberOfTabs(text);
                    const newLine = text.slice(0, text.indexOf(' ')).toLowerCase();
                    if (numOfTabs == 0){
                        topLevelLine = text;
                    }
                    if (newLine.includes("pilot") && numOfTabs == 0){
                        output.pilot = text;
                        //topLevelLine = text
                    }
                    if (newLine.includes("mission") && numOfTabs == 0){
                        //topLevelLine = text
                        output.missions.push(text);
                    }
                    if (newLine.includes("conditions")){
                        //seems pointless but stops extra value being added
                    }
                    else if (topLevelLine.includes("conditions")){
                        output.conditions.push(text);
                    }
                    if (newLine.includes("visited") && numOfTabs == 0){
                        output.visited.push(text);
                    }
                    if (newLine.includes("ship") && numOfTabs == 0){
                        output.ships.push(text);
                    }
                    else if (topLevelLine.includes("ship")){
                        output.ships.push(text);
                    }

                    //let element = "li";
                    //if (!data[line].startsWith('\t')) {
                    //    element = "ul"};
                    //const newDiv = document.createElement(element);
                    //newDiv.innerHTML = data[line];
                    //target.appendChild(newDiv);
                    
                }
                console.log(output);
            }
            
            reader.readAsText(file)
        }
        function numberOfTabs(text) {
            return text.match(/^\s*/)[0].length;
            }
    </script>
</body>
</html>