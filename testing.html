<!DOCTYPE html>
<html>
<head>
    <title>SpeccyPlays Endless Sky save file viewer</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.png" />
    <link rel="stylesheet" type="text/css" href="/CSS/styles.css" />
</head>
<body>
    <button onclick="openFile()">Open a file</button>
    <input id="inp" type='file' style="visibility:hidden;" onchange="readFile(event)" />
    <div id="contents">
    <ul id="result"></ul>
    </div>
    <script>
        class Node {
            constructor(value, tabCount){
                this.value = value;
                this.parent = null;
                this.indentLevel = tabCount;
                this.children = [];
            }
        }
        function openFile() {
            document.getElementById('inp').click();
        }
        function readFile(e) {
            var file = e.target.files[0];
            if (!file) return;
            var reader = new FileReader();
            reader.onload = function(e) {
                let target = document.getElementById('result');
                const data = e.target.result.split('\n');
                //const lines = data.split('\n').toString();
                let root = new Node("Top level", 0);
                
                for (line in data){
                    const newDiv = document.createElement('ul');
                    newDiv.innerHTML = data[line];
                    target.appendChild(newDiv);
                    let higherNode = root;
                    const count = numberOfTabs(data[line]) + 1;
                    let temp = new Node(data[line], count);
                    let cont = true;
                    let previousNode = null;
                    while (cont){
                        if (higherNode.children.length == 0){
                            temp.parent = higherNode;
                            //higherNode.children = [];
                            higherNode.children.push(temp);
                            console.log("no children");
                            previousNode = temp;
                            break;
                        }
                        if (higherNode.indentLevel == temp.indentLevel){
                            temp.parent = higherNode.parent;
                            higherNode.children.push(temp);
                            console.log("Matched level");
                            previousNode = temp;
                            break;
                        }
                        else {
                            for (let i = 0 ; i < higherNode.children.length; i++){
                                if (higherNode.children[i].indentLevel == temp.indentLevel){
                                    temp.parent = higherNode.children[i].parent;
                                    higherNode.children[i].parent.children.push(temp);
                                    console.log("found right level in child");
                                    cont = false;
                                    previousNode = temp;
                                    break;
                                }
                                else {
                                    higherNode = higherNode.children[i];
                                }
                            }
                        }
                    }
                    
                    //let element = "li";
                    //if (!data[line].startsWith('\t')) {
                    //    element = "ul"};
                    //const newDiv = document.createElement(element);
                    //newDiv.innerHTML = data[line];
                    //target.appendChild(newDiv);
                    
                }
                console.log(root);
            }
            
            reader.readAsText(file)
        }
        function numberOfTabs(text) {
            return text.match(/^\s*/)[0].length;
            }
    </script>
</body>
</html>